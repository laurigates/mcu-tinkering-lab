# Wiring Diagram (Conceptual)

This diagram shows the primary connections between the hardware components. It uses [Mermaid](https://mermaid.js.org/) syntax.

**Note:** All components must share a common ground (GND). The 5V rail generated by the XL6009 boost converter powers multiple components as described in `docs/HARDWARE.md`.

```mermaid
graph TD
    subgraph Power System
        Bat[2x 18650 Batteries] --> XL6009[XL6009 Boost Converter];
        XL6009 -- 5V Rail --> ESP32_Main[(DOIT ESP32 DevKit V1)];
        XL6009 -- 5V Rail --> MD[(TB6612FNG Motor Driver)];
        XL6009 -- 5V Rail --> PCA[(PCA9685 PWM Driver)];
        XL6009 -- 5V Rail --> CAM[(ESP32-CAM)];
    end

    subgraph Main Controller
        ESP32_Main -- GPIO 33 (LEFT_PWMB) --> MD;
        ESP32_Main -- GPIO 32 (LEFT_IN2) --> MD;
        ESP32_Main -- GPIO 35 (LEFT_IN1) --> MD;
        ESP32_Main -- GPIO 25 (STBY) --> MD;
        ESP32_Main -- GPIO 18 (RIGHT_IN1) --> MD;
        ESP32_Main -- GPIO 19 (RIGHT_IN2) --> MD;
        ESP32_Main -- GPIO 23 (RIGHT_PWMA) --> MD;

        ESP32_Main -- GPIO 21 (SDA) --> PCA;
        ESP32_Main -- GPIO 22 (SCL) --> PCA;

        ESP32_Main -- GPIO 5 (PIEZO_PIN) --> Piezo[Piezo Buzzer];

        ESP32_Main -- GPIO 16 (UART2 RX) --> CAM_TX(GPIO 17 UART2 TX);
        ESP32_Main -- GPIO 17 (UART2 TX) --> CAM_RX(GPIO 16 UART2 RX);
    end

    subgraph Camera Module
        CAM -- 5V Power --> XL6009;
        CAM -- GND --> Common_GND(Common GND);
        CAM_RX --> CAM;
        CAM_TX --> CAM;
    end

    subgraph Motor Driver Connections
        MD -- Motor A Out --> M_R[Right Motor];
        MD -- Motor B Out --> M_L[Left Motor];
        MD -- VMotor (5V) --> XL6009;
        MD -- VCC (5V) --> XL6009;
        MD -- GND --> Common_GND;
    end

    subgraph PCA9685 Connections
        PCA -- VCC (5V) --> XL6009;
        PCA -- V+ (5V) --> XL6009;
        PCA -- GND --> Common_GND;
        PCA -- Ch 0 (L_R) --> LED_L[Left RGB LED];
        PCA -- Ch 1 (L_G) --> LED_L;
        PCA -- Ch 2 (L_B) --> LED_L;
        PCA -- Ch 3 (R_R) --> LED_R[Right RGB LED];
        PCA -- Ch 4 (R_G) --> LED_R;
        PCA -- Ch 5 (R_B) --> LED_R;
        PCA -- Ch 6 (Pan) --> Servo_Pan[Pan Servo (SG90)];
        PCA -- Ch 7 (Tilt) --> Servo_Tilt[Tilt Servo (SG90)];
    end

    subgraph Peripherals
        Piezo -- GND --> Common_GND;
        LED_L -- Common Anode (V+) --> PCA;
        LED_R -- Common Anode (V+) --> PCA;
        Servo_Pan -- Power (5V) --> PCA;
        Servo_Pan -- GND --> Common_GND;
        Servo_Tilt -- Power (5V) --> PCA;
        Servo_Tilt -- GND --> Common_GND;
        M_L -- Power --> MD;
        M_R -- Power --> MD;
    end

    style Common_GND fill:#ccc,stroke:#333,stroke-width:2px
```

**Key Connections:**

*   **Power:** Batteries -> XL6009 -> 5V rail distributed to ESP32, Motor Driver, PCA9685, ESP32-CAM.
*   **Ground:** All components share a common ground.
*   **Motor Control:** ESP32 GPIOs control direction (IN1/IN2), speed (PWM), and standby (STBY) on the TB6612FNG.
*   **I2C:** ESP32 communicates with PCA9685 via GPIO 21 (SDA) and 22 (SCL).
*   **PWM Outputs (PCA9685):** Controls RGB LEDs (Channels 0-5) and Servos (Channels 6-7).
*   **Serial:** ESP32 (UART2: GPIO 16/17) communicates with ESP32-CAM (UART2: GPIO 16/17). Remember RX connects to TX and vice-versa.
*   **Sound:** ESP32 GPIO 5 drives the Piezo buzzer.
